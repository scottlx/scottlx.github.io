# AI编程开发流程与实践指南

## 一、AI编程与传统编程的对比

### 效率提升指标

- **需求澄清与方案对齐**：通过结构化Prompt与规范化上下文，平均节省30%-50%沟通时间
- **代码产出**：CRUD/DTO/Mapper/单测样例等机械性工作节省60%-80%时间
- **文档流程**：接口卡片、变更日志、提交说明自动化生成，节省70%手工编写时间
- **缺陷修复**：依据失败用例与日志回溯定位，迭代Prompt驱动修复，平均减少30%-40%回合数

### 知识沉淀方式

- **Prompt库**：场景化模板（需求→设计→WBS→代码→单测→评审），团队共用与复用

### 团队协作改进

- **AI结对**：评审清单驱动的人机互评，减少盲点；跨时区异步协作提高效率

## 二、面向AI开发流程

```
 工程结构分析 → 用户规则配置 → 需求分析 → 设计生成 → 任务拆解 → 代码生成与验证 → 人工完成 
```

### 2.1 工程结构分析

- **目标**：AI快速识别模块架构、技术栈与关键约束
- **产物**：模块清单、依赖拓扑、关键约束（JDK版本、容器、数据库、事务边界、序列化等）
- 清单示例：
  - Web层：Spring MVC Controller
  - 业务层：Service/Impl + 声明式事务
  - 数据层：MyBatis + MySQL (gfp_trh)
  - 公共层：常量/工具类/Lombok
  - 集成：Dubbo、Redis、IFLOW（审批）

### 2.2 用户规则配置（突出示例规范等）

- 目标：将企业规则（署名、权限、审计、乐观锁）显式化，纳入自动生成
- 核心规则：
  - 乐观锁：data_version字段，更新时WHERE条件包含版本；冲突返回409与重试建议
  - 软删除：data_status维护；查询默认过滤；删除为逻辑删除
  - 审计字段：create_by/create_time/update_by/update_time标准化
  - 权限与数据范围：RBAC + 数据权限注解/拦载

### 2.3 需求分析（标准化模板应用）

- **目标**：将自然语言需求转为结构化输入（领域对象/场景/约束/验收标准）
- **产物**：需求卡（见"模板资源-需求输入模板"）

### 2.4 设计生成 （接口契约示例）

- **目标**：以契约为中心，定义接口、错误码、并发与幂等策略
- 契约示例（REST基础）：
  - 路径：POST /api/v1/quotations
  - 幂等：Idempotency-Key请求头；重复请求返回相同结果（200/201）
- **设计卡片间时输出**：数据模型、状态流转、审计与日志规范

### 2.5 任务拆解（WBS生成示例）

- WBS示例（银行报价/薪酬增价）：
  - W1 契约补充与对齐（错误码/幂等/并发）
  - W2 DTO与校验器（JSR-303）
  - W3 Service接口与实现（事务/幂等/审计）
  - W4 MyBatis实体/Mapper/XML（乐观锁/软删/索引）
  - W5 控制器与异常处理（统一错误响应）
  - W6 单元/集成测试（覆盖边界与异常）
  - W7 指标与日志（关键字段/维度）
  - W8 文档与API卡片（示例请求/响应）

### 2.6 代码生成与验证

- **生成**：计划→执行→校验→业务审查→生成实现说明MD
- 验证：
  - 构建：mvn -DskipTests=false test
  - 数据：本地库或容器化MySQL，迁移SQL可回滚
  - 合同：基于契约的测试（HTTP/JSON断言）
- **失败即停**：任何红灯回到上一步修正

### 2.7 人工集成（重点审查项）

- **命名一致性、边界与异常处理、事务与锁、日志级别与脱敏、性能热点（索引/批量/分页）、安全（鉴权/鉴权绕过/注入）、国际化与可观察性、变更说明与影响面评估**

## 三、实践项目实例

**典型微服务**：融资管理-银行报价服务

### 1. 工程结构分析

**提示词实例：**

```javascript
分析当前项目结构并许输出以下清单：
1. 模块清单（分层结构）
2. 技术栈明细
3. 关键约束清单：
   - JDK版本要求
   - 容器环境
   - 数据库配置
   - 事务边界定义
   - 序列化机制
4. 依赖拓扑关系

示例格式：
- 【层级】：【主要组件/技术】
- 依赖关系：【上游】->【下游】
- 约束项：【类型】：【具体约束】
```

### 2. 用户规则配置

**提示词实例：**

```javascript
企业规则配置规范（显式化机制规则）
目标：将以下企业级规则标准化并纳入自动生成流程：
1. 乐观锁机制
   - 字段：data_version
   - 更新条件：WHERE必须包含版本未检验
   - 冲突处理：返回HTTP 409并提供重试建议

2. 软删除实现
   - 状态字段：data_status
   - 查询过滤：默认排除已删除数据
   - 删除操作：仅标记为逻辑删除

3. 审计字段规范
   - 必含字段：create_by/create_time/update_by/update_time
   - 自动维护：创建/更新时自动填充

4. 权限控制
   - 模型：RBAC基础
   - 实现：数据权限注解+拦截器
   - 范围：支持数据级权限控制

要求：生成标准化配置模板板及实现示例
```

### 3. 需求分析（标准化模板应用）

需要先将需求文档上传到知识库或者同步，进行向量化

**提示词实例：**

```javascript
@project_rules.md #融资服务升级 @20250425.md
请完成以下任务：
1. 存储研究政权及投融资服务升级中投融资报价服务化三期优化，docx文件第9、10、11、15、16等时需来内容
2. 将需求内容结构化为J3编撰器分了解读的格式
3. 在20251017文件夹下新增markdown文件存放有效的需求
4. 参考文件：20250425.md（含法规一资料和条款构定义）
5. 相关代码目录：com.midea.jr.gfp.trh.gfbm.biz.bid
要求：
- 确保需求全转换/细则完整
- 保持markdown格式规范
- 注明原始需求来源
```

### 4. 根据需求内容，生成对应的设计文档

**提示词实例：**

```javascript
请根据需求文档内容解析并输出完整的设计文档，要求如下：
1. 文档结构：
   - 流程图（附流程说明）
   - 状态转换图（含状态说明）
   - 数据库表设计（字段、类型、约束）
   - 各模块功能说明
2. 具体要求：
   - 字段需与需求文档完全一致
   - 技术细节准确无误
   - 逻辑清晰完整
3. 输出格式：
   - 使用Markdown格式
   - 保存至20251017目录下
   - 文件名：系统设计文档.md
4. 质量要求：
   - 结构层次分明
   - 内容完整无遗漏
   - 表达准确专业
```

### 5. 任务拆解

**提示词实例：**

```javascript
请按以下要求优化任务拆解：
1. 按功能点而非代码层级进行拆解
2. 每个任务步骤都需明确具体执行内容
3. 确保AI能精确理解每个子任务
4. 拆解结果需便于无关联效率任务上线工
5. 暂不需要生成实际代码
要求拆解结果：
- 功能模块清晰划分
- 每个步骤有明确的输入输出
- 执行逻辑完整连贯
- 关键节点标准清楚
- 每个任务生成一个md文件，文件名约定TASK001_任务名称.md生成
```

### 6. 代码生成-根据需求，设计和拆解任务来生成对应的代码

**提示词实例：**

```javascript
生成对接C4架构工具类：
要求如下：
1. 通过C4接口的API接口名称要求    #C4API后端接口服务
2. 封装接口对接能力基础工具类
3. 封装对应：创建用户、修改密码、登录验证、查询用户等接口    #C4API后端接口服务优化后的提示：
a. 重新设计C4ApiManager接口，需清晰：
   - 高性能要求（响应时间<100ms，吞吐量>1000TPS）
   - 高健壮性（错误处理完善，异常捕获率100%）
b. 工具类存放规范：
   - 包路径：com.midea.jr.gfp.trh.gfbm.biz.bid
   - 按功能模块创建子包分类存放
c. 输出要求：
   - 提供完整的类结构设计
   - 包含关键方法实现示例
   - 注明性能优化点和健壮性保障措施
```



## 四、常见的问题和反模式

### 上下文不足

- **症状**：AI误读模型或技术栈，生成代码不可用
- **对策**：显式提供模块结构、关键实体、接口契约、示例数据、版本约束、运行命令和测试用例

### 过度生成

- **症状**：一次性产出大量代码，验证缺失，错误难以定位
- **对策**：小步快跑；每步生成即验证，失败即停；保障最小可行方案

### 契约缺失

- **症状**：接口边界、错误码、幂等/并发未定义，联调频繁返工
- **对策**：合同先行；提供OpenAPI片段、错误码表、并发/乐观锁策略与示例